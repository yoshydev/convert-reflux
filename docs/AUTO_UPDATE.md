# 自動アップデート機能

このアプリケーションには、GitHub Releases から新しいバージョンを自動的に検知・ダウンロードする機能が実装されています。

## 機能概要

- アプリ起動時に自動的にアップデートをチェック
- 新しいバージョンが利用可能な場合、ダイアログで通知
- ユーザーの承認後、バックグラウンドでダウンロード
- ダウンロード完了後、再起動してインストール
- UI上でアップデートステータスを確認可能

## 技術スタック

- **electron-updater**: Electron アプリの自動アップデート機能
- **electron-log**: アップデートプロセスのログ記録
- **GitHub Releases**: 配布プラットフォーム

## 使用方法

### 開発環境

開発環境では自動アップデート機能は無効化されています。

### 本番環境

1. **アプリケーションの起動**
   - アプリ起動から3秒後に自動的にアップデートをチェックします

2. **手動チェック**
   - アプリ内の「アップデートを確認」ボタンをクリック

3. **アップデート利用可能時**
   - ダイアログが表示され、ダウンロードするか選択できます
   - 「ダウンロード」を選択すると、バックグラウンドでダウンロードが開始されます
   - ダウンロード進捗がUI上に表示されます

4. **インストール**
   - ダウンロード完了後、再起動してインストールするか選択できます
   - 「再起動」を選択すると、アプリが自動的に再起動し、新しいバージョンがインストールされます

## リリース手順

新しいバージョンをリリースする際の手順:

### 1. バージョンの更新

```bash
# package.json のバージョンを更新
npm version patch  # または minor, major
```

### 2. ビルド

```bash
npm run build
```

これにより、`dist` ディレクトリに以下のファイルが生成されます:
- `Reflux Converter-X.X.X-Setup.exe` (インストーラー)
- `latest.yml` (アップデート情報ファイル)

### 3. GitHub Release の作成

1. GitHub リポジトリで新しいリリースを作成
2. タグは `vX.X.X` の形式で作成（例: `v1.0.1`）
3. 以下のファイルをアップロード:
   - `Reflux Converter-X.X.X-Setup.exe`
   - `latest.yml`

### 4. リリースの公開

リリースを公開すると、既存のユーザーに自動的にアップデート通知が届きます。

## 設定ファイル

`electron-builder.yml` に以下の設定が含まれています:

```yaml
publish:
  provider: github
  owner: yoshydev
  repo: convert-reflux
  releaseType: release
```

## トラブルシューティング

### アップデートが検知されない

1. GitHub Release が正しく公開されているか確認
2. `latest.yml` ファイルがアップロードされているか確認
3. リポジトリが公開されているか確認（プライベートリポジトリの場合は追加設定が必要）

### ダウンロードエラー

1. インターネット接続を確認
2. ファイアウォール設定を確認
3. ログファイルを確認（開発者ツールのコンソール）

### インストールエラー

1. アプリケーションの既存のインスタンスが完全に終了しているか確認
2. 管理者権限で実行してみる
3. 手動でインストーラーをダウンロードして実行

## ログの確認

アップデートプロセスのログは以下の場所に保存されます:

- **Windows**: `%USERPROFILE%\AppData\Roaming\reflux-converter\logs`
- **macOS**: `~/Library/Logs/reflux-converter`
- **Linux**: `~/.config/reflux-converter/logs`

## セキュリティ

- すべてのアップデートファイルは GitHub から直接ダウンロードされます
- electron-updater は自動的に署名を検証します（Windows の場合、コードサイニング証明書が必要）

## 参考資料

- [electron-updater 公式ドキュメント](https://www.electron.build/auto-update)
- [electron-builder 公式ドキュメント](https://www.electron.build/)
